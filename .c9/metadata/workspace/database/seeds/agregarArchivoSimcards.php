{"filter":false,"title":"agregarArchivoSimcards.php","tooltip":"/database/seeds/agregarArchivoSimcards.php","undoManager":{"mark":28,"position":28,"stack":[[{"start":{"row":13,"column":8},"end":{"row":13,"column":10},"action":"remove","lines":["//"],"id":2},{"start":{"row":13,"column":8},"end":{"row":70,"column":9},"action":"insert","lines":["$file = $request->file('image');","        if (($gestor = fopen($file, \"r\")) !== FALSE) {","            $opcion = fgetcsv($gestor, 1000, \",\");","            if($opcion[0] == 'AGREGAR'){","                while (($vars = fgetcsv($gestor, 1000, \",\")) !== FALSE) {","                    $fecha_vencimiento = date_create_from_format(\"d/m/y\",$vars[3]);","                    $simc = \\DB::table('simcards')->where('numero', '=',$vars[0])->orwhere('ICC', '=',$vars[1])->first();","                    if($simc != null){","                        $sim = \\App\\Simcard::find($simc->ICC);","                        $sim->delete();","                    }","                    \\App\\Simcard::create([","                     'numero' => $vars[0],","                     'ICC' => $vars[1],","                     'fecha_vencimiento' => $fecha_vencimiento,","                     'fecha_activacion' =>  null,","                     'nombreSubdistribuidor' => $vars[2],","                     'tipo' => $vars[4],","                     'paquete' => 0,","                     'fecha_entrega' => null","                     ]);","                }","            }else if($opcion[0] == 'ACTIVAR'){","                while (($vars = fgetcsv($gestor, 1000, \",\")) !== FALSE) {","                   $fecha_activacion = date_create_from_format(\"d/m/y\",$vars[1]);","                   $simc = \\DB::table('simcards')->where('numero', '=',$vars[0])->first();","                   if($simc == null){","                       $ICC = \\DB::table('simcards')->select('ICC')->orderBy(\\DB::raw('ICC*1'))->first();","                       $ICC = $ICC->ICC - 1;","                       $fecha_vencimiento = date_add($fecha_activacion,date_interval_create_from_date_string(\"9 months\"));","                       $fecha_activacion = date_create_from_format(\"d/m/y\",$vars[1]);","                       \\App\\Simcard::create([","                         'numero' => $vars[0],","                         'ICC' => $ICC,","                         'fecha_vencimiento' => $fecha_vencimiento,","                         'fecha_activacion' =>  null,","                         'nombreSubdistribuidor' => 'SIN ASIGNAR',","                         'tipo' => 1,","                         'paquete' => 0,","                         'fecha_entrega' => null","                         ]);","                   }else{","                       $ICC = $simc->ICC;","                   }","                   $sim = \\App\\Simcard::find($ICC);","                   if($sim->tipo == 1){","                        $fecha_vencimiento = date_add($fecha_activacion,date_interval_create_from_date_string(\"9 months\"));","                   }else{","                       $fecha_vencimiento = date_add($fecha_activacion,date_interval_create_from_date_string(\"12 months\"));","                   }","                   $fecha_activacion = date_create_from_format(\"d/m/y\",$vars[1]);","                   $sim->fecha_activacion = $fecha_activacion;","                   $sim->fecha_vencimiento = $fecha_vencimiento;","                   $sim->save();","                }","            }","            fclose($gestor);","        }"]}],[{"start":{"row":13,"column":7},"end":{"row":13,"column":40},"action":"remove","lines":[" $file = $request->file('image');"],"id":3},{"start":{"row":13,"column":7},"end":{"row":13,"column":8},"action":"insert","lines":[" "]}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"insert","lines":["'"],"id":4}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["'"],"id":5}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["$"],"id":6}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["f"],"id":7}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["i"],"id":8}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["l"],"id":9}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"remove","lines":["e"],"id":10}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":57},"action":"insert","lines":["'public/temp/comisiones.csv'"],"id":11}],[{"start":{"row":14,"column":42},"end":{"row":14,"column":52},"action":"remove","lines":["comisiones"],"id":12},{"start":{"row":14,"column":42},"end":{"row":14,"column":43},"action":"insert","lines":["s"]}],[{"start":{"row":14,"column":43},"end":{"row":14,"column":44},"action":"insert","lines":["i"],"id":13}],[{"start":{"row":14,"column":44},"end":{"row":14,"column":45},"action":"insert","lines":["m"],"id":14}],[{"start":{"row":14,"column":45},"end":{"row":14,"column":46},"action":"insert","lines":["c"],"id":15}],[{"start":{"row":14,"column":46},"end":{"row":14,"column":47},"action":"insert","lines":["a"],"id":16}],[{"start":{"row":14,"column":47},"end":{"row":14,"column":48},"action":"insert","lines":["r"],"id":17}],[{"start":{"row":14,"column":48},"end":{"row":14,"column":49},"action":"insert","lines":["d"],"id":18}],[{"start":{"row":14,"column":49},"end":{"row":14,"column":50},"action":"insert","lines":["s"],"id":19}],[{"start":{"row":12,"column":5},"end":{"row":13,"column":8},"action":"remove","lines":["","        "],"id":20}],[{"start":{"row":68,"column":28},"end":{"row":69,"column":0},"action":"insert","lines":["",""],"id":21},{"start":{"row":69,"column":0},"end":{"row":69,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":69,"column":12},"end":{"row":69,"column":49},"action":"insert","lines":["unlink('public/temp/comisiones.csv');"],"id":22}],[{"start":{"row":69,"column":32},"end":{"row":69,"column":42},"action":"remove","lines":["comisiones"],"id":23},{"start":{"row":69,"column":32},"end":{"row":69,"column":33},"action":"insert","lines":["s"]}],[{"start":{"row":69,"column":33},"end":{"row":69,"column":34},"action":"insert","lines":["i"],"id":24}],[{"start":{"row":69,"column":34},"end":{"row":69,"column":35},"action":"insert","lines":["m"],"id":25}],[{"start":{"row":69,"column":35},"end":{"row":69,"column":36},"action":"insert","lines":["c"],"id":26}],[{"start":{"row":69,"column":36},"end":{"row":69,"column":37},"action":"insert","lines":["a"],"id":27}],[{"start":{"row":69,"column":37},"end":{"row":69,"column":38},"action":"insert","lines":["r"],"id":28}],[{"start":{"row":69,"column":38},"end":{"row":69,"column":39},"action":"insert","lines":["d"],"id":29}],[{"start":{"row":69,"column":39},"end":{"row":69,"column":40},"action":"insert","lines":["s"],"id":30}]]},"ace":{"folds":[],"scrolltop":540,"scrollleft":0,"selection":{"start":{"row":39,"column":23},"end":{"row":39,"column":105},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":29,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1450152673906,"hash":"1d60be1b294696375f67efd392eee364b9002a4a"}